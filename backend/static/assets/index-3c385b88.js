import{j as H,r as g,a as me}from"./react-a9b6c34a.js";import{a as ge,c as _e}from"./react-dom-2c65b678.js";import{L as fe,H as ye}from"./react-router-dom-bd3dd696.js";import{O as Ce,d as Se,e as $}from"./react-router-035a0642.js";import{S as ve,A as be,a as we,R as Ne}from"./microsoft-cognitiveservices-speech-sdk-ef591a5f.js";import{p as ee}from"./dompurify-7357be35.js";import{S as Te,a as y,I as F,E as Le,P as ke,T as j,B as xe,b as Ae,c as Re,d as Ie,e as qe,f as te,D as Pe,g as Me,h as Be,i as ze,j as Ee,C as D,k as Qe}from"./@fluentui-1e97e19c.js";import{J as $e,i as Fe}from"./@react-spring-c543ddb1.js";import"./bent-d4cce1f4.js";import"./scheduler-04ce0582.js";import"./@remix-run-65e438cc.js";import"./uuid-a960c1f4.js";import"./tslib-14a4c710.js";import"./@microsoft-31b40247.js";import"./@griffel-96af2275.js";import"./@emotion-8a8e73f6.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))m(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&m(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const Y=H.Fragment,e=H.jsx,d=H.jsxs;const De="_layout_o4bzc_1",Oe="_header_o4bzc_13",je="_headerContainer_o4bzc_23",Ge="_headerTitleContainer_o4bzc_39",He="_headerLogo_o4bzc_55",Ue="_headerTitle_o4bzc_39",Ke="_headerNavList_o4bzc_73",We="_headerNavPageLink_o4bzc_85",Ve="_headerNavPageLinkActive_o4bzc_113",Je="_headerNavLeftMargin_o4bzc_123",Ye="_headerRightText_o4bzc_131",Xe="_microsoftLogo_o4bzc_141",Ze="_githubLogo_o4bzc_151",A={layout:De,header:Oe,headerContainer:je,headerTitleContainer:Ge,headerLogo:He,headerTitle:Ue,headerNavList:Ke,headerNavPageLink:We,headerNavPageLinkActive:Ve,headerNavLeftMargin:Je,headerRightText:Ye,microsoftLogo:Xe,githubLogo:Ze},et=()=>d("div",{className:A.layout,children:[e("header",{className:A.header,role:"banner",children:d("div",{className:A.headerContainer,children:[e(fe,{to:"/",className:A.headerTitleContainer,children:e("h3",{className:"{styles.headerTitle}",children:"Personal Assistant"})}),e("h4",{className:A.headerRightText,children:"Azure OpenAI + LangChain"})]})}),e(Ce,{})]}),tt=()=>e("h1",{children:"404"}),nt="_container_1qf1y_1",at="_chatRoot_1qf1y_15",st="_chatContainer_1qf1y_25",ot="_chatEmptyState_1qf1y_41",rt="_chatEmptyStateTitle_1qf1y_61",it="_chatEmptyStateSubtitle_1qf1y_75",ct="_chatMessageStream_1qf1y_107",lt="_chatMessageGpt_1qf1y_131",ut="_chatMessageGptMinWidth_1qf1y_145",dt="_chatInput_1qf1y_155",ht="_chatAnalysisPanel_1qf1y_181",pt="_chatSettingsSeparator_1qf1y_197",mt="_loadingLogo_1qf1y_205",gt="_commandsContainer_1qf1y_213",_t="_commandButton_1qf1y_223",p={container:nt,chatRoot:at,chatContainer:st,chatEmptyState:ot,chatEmptyStateTitle:rt,chatEmptyStateSubtitle:it,chatMessageStream:ct,chatMessageGpt:lt,chatMessageGptMinWidth:ut,chatInput:dt,chatAnalysisPanel:ht,chatSettingsSeparator:pt,loadingLogo:mt,commandsContainer:gt,commandButton:_t};async function ft(t){var m,n,o,c,C,l,_,u,h;const a=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:t.history,approach:t.approach,overrides:{semantic_ranker:(m=t.overrides)==null?void 0:m.semanticRanker,semantic_captions:(n=t.overrides)==null?void 0:n.semanticCaptions,top:(o=t.overrides)==null?void 0:o.top,temperature:(c=t.overrides)==null?void 0:c.temperature,prompt_template:(C=t.overrides)==null?void 0:C.promptTemplate,prompt_template_prefix:(l=t.overrides)==null?void 0:l.promptTemplatePrefix,prompt_template_suffix:(_=t.overrides)==null?void 0:_.promptTemplateSuffix,exclude_category:(u=t.overrides)==null?void 0:u.excludeCategory,suggest_followup_questions:(h=t.overrides)==null?void 0:h.suggestFollowupQuestions}})}),i=await a.json();if(a.status>299||!a.ok)throw Error(i.error||"Unknown error");return i}async function yt(t){var a=ve.fromSubscription("<your speech service key>","southeastasia");const i=be.fromDefaultSpeakerOutput();a.speechSynthesisVoiceName="zh-CN-YunxiNeural";const m=new we(a,i),o=t.answer.replace(/\[[^\]]*\]/g,"");console.log(t.answer),m.speakTextAsync(o,function(c){c.reason===Ne.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+c.errorDetails+`
Did you set the speech resource key and region values?`),m.close()},function(c){console.trace("err - "+c),m.close()})}function Ct(t){return`/content/${t}`}var ne=(t=>(t.RetrieveThenRead="rtr",t.ReadRetrieveRead="rrr",t.ReadDecomposeAsk="rda",t))(ne||{});const St="_answerContainer_1tryd_1",vt="_answerLogo_1tryd_17",bt="_answerText_1tryd_25",wt="_selected_1tryd_43",Nt="_citationLearnMore_1tryd_51",Tt="_citation_1tryd_51",Lt="_followupQuestionsList_1tryd_95",kt="_followupQuestionLearnMore_1tryd_103",xt="_followupQuestion_1tryd_95",At="_supContainer_1tryd_141",Rt="_retryButton_1tryd_199",It="_loadingdots_1tryd_243",qt="_loading_1tryd_243",f={answerContainer:St,answerLogo:vt,answerText:bt,selected:wt,citationLearnMore:Nt,citation:Tt,followupQuestionsList:Lt,followupQuestionLearnMore:kt,followupQuestion:xt,supContainer:At,retryButton:Rt,loadingdots:It,loading:qt};function Pt(t,a){const i=[],m=[];let n=t.replace(/<<([^>>]+)>>/g,(l,_)=>(m.push(_),""));n=n.trim();const o=n.split(/\[([^\]]+)\]+\(([^\)]+)\)/g);console.log(o);let c=n.match(/\[([^\]]+)\]+\(([^\)]+)\)/g);return console.log(c),c&&c.map((l,_)=>{const u=l.split("]")[0].replace("[",""),h=l.split("]")[1].replace("(","").replace(")","");console.log(u),console.log(h),i.push({id:_,name:u,path:h})}),{answerHtml:o.map((l,_)=>{if(_%3===0)return l;if(_%3==1){let u=i.find(M=>M.name==l),h=u?u.id:-1;h!==-1?h=u?u.id+1:-1:h=i.length;const v=Ct(l);return ge(e("a",{className:"supContainer",title:l,onClick:()=>a(v),children:e("sup",{children:h})}))}else return""}).join(""),citations:i,followupQuestions:m}}const ae=()=>e(Te,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),Mt=({answer:t,isSelected:a,onCitationClicked:i,onThoughtProcessClicked:m,onSupportingContentClicked:n,onFollowupQuestionClicked:o,onReadAnswerClicked:c,showFollowupQuestions:C})=>{const l=g.useMemo(()=>Pt(t.answer,i),[t]),_=ee.sanitize(l.answerHtml);return d(y,{className:`${f.answerContainer} ${a&&f.selected}`,verticalAlign:"space-between",children:[e(y.Item,{children:d(y,{horizontal:!0,horizontalAlign:"space-between",children:[e(ae,{}),d("div",{children:[e(F,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>m(),disabled:!t.thoughts}),e(F,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>n(),disabled:!t.data_points.length}),e(F,{style:{color:"black"},iconProps:{iconName:"ReadOutLoud"},title:"Read answer",ariaLabel:"Read answer",onClick:()=>c(),disabled:!t.answer})]})]})}),e(y.Item,{grow:!0,children:e("div",{className:f.answerText,dangerouslySetInnerHTML:{__html:_}})}),!!l.citations.length&&e(y.Item,{children:d(y,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e("span",{className:f.citationLearnMore,children:"来源:"}),l.citations.map((u,h)=>{const v=u.path;return e("a",{className:f.citation,title:u.name,onClick:()=>i(v),children:`${++h}. ${u.name}`},h)})]})}),!!l.followupQuestions.length&&C&&o&&e(y.Item,{children:d(y,{horizontal:!0,wrap:!0,className:`${l.citations.length?f.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e("span",{className:f.followupQuestionLearnMore,children:"您可能还想问:"}),l.followupQuestions.map((u,h)=>e("a",{className:f.followupQuestion,title:u,onClick:()=>o(u),children:`${u}`},h))]})})]})},Bt=()=>{const t=$e({from:{opacity:0},to:{opacity:1}});return e(Fe.div,{style:{...t},children:d(y,{className:f.answerContainer,verticalAlign:"space-between",children:[e(ae,{}),e(y.Item,{grow:!0,children:d("p",{className:f.answerText,children:["正在生成回答",e("span",{className:f.loadingdots})]})})]})})},zt=({error:t,onRetry:a})=>d(y,{className:f.answerContainer,verticalAlign:"space-between",children:[e(Le,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e(y.Item,{grow:!0,children:e("p",{className:f.answerText,children:t})}),e(ke,{className:f.retryButton,onClick:a,text:"Retry"})]}),Et="_questionInputContainer_wokwf_1",Qt="_questionInputTextArea_wokwf_19",$t="_questionInputButtonsContainer_wokwf_29",Ft="_questionInputSendButton_wokwf_41",Dt="_questionInputSendButtonDisabled_wokwf_49",w={questionInputContainer:Et,questionInputTextArea:Qt,questionInputButtonsContainer:$t,questionInputSendButton:Ft,questionInputSendButtonDisabled:Dt},Ot=({onSend:t,disabled:a,placeholder:i,clearOnSend:m})=>{const[n,o]=g.useState(""),c=()=>{if(a||!n.trim()){console.log("send disabled"),console.log("question: "+n);return}t(n),m&&o("")},C=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),c())},l=(u,h)=>{h?h.length<=1e3&&o(h):o("")},_=a||!n.trim();return d(y,{horizontal:!0,className:w.questionInputContainer,children:[e(j,{className:w.questionInputTextArea,placeholder:i,multiline:!0,resizable:!1,borderless:!0,value:n,onChange:l,onKeyDown:C}),d("div",{className:w.questionInputButtonsContainer,children:[e("div",{className:`${w.questionInputSendButton} ${_?w.questionInputSendButtonDisabled:""}`,"aria-label":"语音输入",onClick:c,children:e(xe,{primaryFill:"rgba(115, 118, 225, 1)"})}),e("div",{className:`${w.questionInputSendButton} ${_?w.questionInputSendButtonDisabled:""}`,"aria-label":"提问按钮",onClick:c,children:e(Ae,{primaryFill:"rgba(115, 118, 225, 1)"})})]})]})},jt="_examplesNavList_v5q0z_1",Gt="_example_v5q0z_1",Ht="_exampleText_v5q0z_53",G={examplesNavList:jt,example:Gt,exampleText:Ht},Ut=({text:t,value:a,onClick:i})=>e("div",{className:G.example,onClick:()=>i(a),children:e("p",{className:G.exampleText,children:t})}),Kt=[{text:"今天有没有3个人的会议室，要有TV的",value:"今天有没有3个人的会议室，要有TV的"},{text:"今天深圳的天气怎么样",value:"今天深圳的天气怎么样"},{text:"最近有什么好看的电影",value:"最近有什么好看的电影"}],Wt=({onExampleClicked:t})=>e("ul",{className:G.examplesNavList,children:Kt.map((a,i)=>e("li",{children:e(Ut,{text:a.text,value:a.value,onClick:t})},i))}),Vt="_container_u4tj7_1",Jt="_message_u4tj7_17",X={container:Vt,message:Jt},O=({message:t})=>e("div",{className:X.container,children:e("div",{className:X.message,children:t})}),Yt="_thoughtProcess_exr0t_1",Xt={thoughtProcess:Yt};var L=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(L||{});const Zt={disabled:!0,style:{color:"grey"}},en=({answer:t,activeTab:a,activeCitation:i,citationHeight:m,className:n,onActiveTabChanged:o})=>{const c=!t.thoughts,C=ee.sanitize(t.thoughts);return e(Re,{className:n,selectedKey:a,onLinkClick:l=>l&&o(l.props.itemKey),children:e(Ie,{itemKey:L.ThoughtProcessTab,headerText:"思维过程",headerButtonProps:c?Zt:void 0,children:e("div",{className:Xt.thoughtProcess,dangerouslySetInnerHTML:{__html:C}})})})},tn="_container_1k5c7_1",nn={container:tn},an=({className:t,onClick:a})=>d("div",{className:`${nn.container} ${t??""}`,onClick:a,children:[e(qe,{}),e(te,{children:"开发人员配置"})]}),sn="_container_7708a_1",on="_disabled_7708a_15",Z={container:sn,disabled:on},rn=({className:t,disabled:a,onClick:i})=>d("div",{className:`${Z.container} ${t??""} ${a&&Z.disabled}`,onClick:i,children:[e(Pe,{}),e(te,{children:"清空对话"})]}),cn=()=>{const[t,a]=g.useState(!1),[i,m]=g.useState(""),[n,o]=g.useState(3),[c,C]=g.useState(!1),[l,_]=g.useState(!1),[u,h]=g.useState(""),[v,M]=g.useState(!0),b=g.useRef(""),U=g.useRef(null),[R,B]=g.useState(!1),[I,q]=g.useState(),[K,z]=g.useState(),[k,N]=g.useState(void 0),[x,E]=g.useState(0),[T,W]=g.useState([]),P=async r=>{b.current=r,I&&q(void 0),B(!0),z(void 0),N(void 0);try{const S={history:[...T.map(J=>({user:J[0],bot:J[1].answer})),{user:r,bot:void 0}],approach:ne.ReadRetrieveRead,overrides:{promptTemplate:i.length===0?void 0:i,excludeCategory:u.length===0?void 0:u,top:n,semanticRanker:c,semanticCaptions:l,suggestFollowupQuestions:v}},V=await ft(S);console.log(V),W([...T,[r,V]])}catch(s){q(s)}finally{B(!1)}},se=()=>{b.current="",I&&q(void 0),z(void 0),N(void 0),W([])};g.useEffect(()=>{var r;return(r=U.current)==null?void 0:r.scrollIntoView({behavior:"smooth"})},[R]);const oe=(r,s)=>{m(s||"")},re=(r,s)=>{o(parseInt(s||"3"))},ie=(r,s)=>{C(!!s)},ce=(r,s)=>{_(!!s)},le=(r,s)=>{h(s||"")},ue=(r,s)=>{M(!!s)},de=r=>{P(r)},he=(r,s)=>{K===r&&k===L.CitationTab&&x===s?N(void 0):(z(r),N(L.CitationTab)),E(s)},Q=(r,s)=>{N(k===r&&x===s?void 0:r),E(s)},pe=async(r,s)=>{E(s);try{const S={answer:r.answer};await yt(S)}catch(S){q(S)}finally{B(!1)}};return d("div",{className:p.container,children:[d("div",{className:p.commandsContainer,children:[e(rn,{className:p.commandButton,onClick:se,disabled:!b.current||R}),e(an,{className:p.commandButton,onClick:()=>a(!t)})]}),d("div",{className:p.chatRoot,children:[d("div",{className:p.chatContainer,children:[b.current?d("div",{className:p.chatMessageStream,children:[T.map((r,s)=>d("div",{children:[e(O,{message:r[0]}),e("div",{className:p.chatMessageGpt,children:e(Mt,{answer:r[1],isSelected:x===s&&k!==void 0,onCitationClicked:S=>he(S,s),onThoughtProcessClicked:()=>Q(L.ThoughtProcessTab,s),onSupportingContentClicked:()=>Q(L.SupportingContentTab,s),onFollowupQuestionClicked:S=>P(S),onReadAnswerClicked:()=>pe(r[1],s),showFollowupQuestions:v&&T.length-1===s},s)})]},s)),R&&d(Y,{children:[e(O,{message:b.current}),e("div",{className:p.chatMessageGptMinWidth,children:e(Bt,{})})]}),I?d(Y,{children:[e(O,{message:b.current}),e("div",{className:p.chatMessageGptMinWidth,children:e(zt,{error:I.toString(),onRetry:()=>P(b.current)})})]}):null,e("div",{ref:U})]}):d("div",{className:p.chatEmptyState,children:[e(Me,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Assistant logo"}),e("h1",{className:p.chatEmptyStateTitle,children:"Your personal assistant"}),e("h2",{className:p.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e(Wt,{onExampleClicked:de})]}),e("div",{className:p.chatInput,children:e(Ot,{clearOnSend:!0,placeholder:"输入问题",disabled:R,onSend:r=>P(r)})})]}),T.length>0&&k&&e(en,{className:p.chatAnalysisPanel,activeCitation:K,onActiveTabChanged:r=>Q(r,x),citationHeight:"810px",answer:T[x][1],activeTab:k}),d(Be,{headerText:"配置",isOpen:t,isBlocking:!1,onDismiss:()=>a(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e(ze,{onClick:()=>a(!1),children:"Close"}),isFooterAtBottom:!0,children:[e(j,{className:p.chatSettingsSeparator,defaultValue:i,label:"更改提问模板",multiline:!0,autoAdjustHeight:!0,onChange:oe}),e(Ee,{className:p.chatSettingsSeparator,label:"最多从搜索中返回的条目数量:",min:1,max:50,defaultValue:n.toString(),onChange:re}),e(j,{className:p.chatSettingsSeparator,label:"排除类别",onChange:le}),e(D,{className:p.chatSettingsSeparator,checked:c,label:"使用语义搜索",onChange:ie}),e(D,{className:p.chatSettingsSeparator,checked:l,label:"使用查询上下文摘要而不是整个文档",onChange:ce,disabled:!c}),e(D,{className:p.chatSettingsSeparator,checked:v,label:"建议后续问题",onChange:ue})]})]})]})};Qe();function ln(){return e(ye,{children:e(Se,{children:d($,{path:"/",element:e(et,{}),children:[e($,{index:!0,element:e(cn,{})}),e($,{path:"*",element:e(tt,{})})]})})})}_e.createRoot(document.getElementById("root")).render(e(me.StrictMode,{children:e(ln,{})}));
//# sourceMappingURL=index-3c385b88.js.map
